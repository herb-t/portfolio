<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner-lite.html">
<link rel="import" href="portfolio-footer.html">
<link rel="import" href="portfolio-project.html">

<dom-module id="portfolio-home">
  <template>
    <style include="shared-styles">

      :host {
        display: block;
      }

      main {
        min-height: 85vh;
      }

      .l-project-grid {
        display: -webkit-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -webkit-flex-direction: row;
            -ms-flex-direction: row;
                flex-direction: row;
        -webkit-flex-wrap: wrap;
            -ms-flex-wrap: wrap;
                flex-wrap: wrap;
        -webkit-align-items: center;
                align-items: center;
        -webkit-box-align: center;
        -moz-box-align: center;
        -ms-flex-align: center;
        -ms-flex-line-pack: justify;  /* IE10 */
        -webkit-justify-content: space-between;
                justify-content: space-between;
        padding: 50px 25px;
        -webkit-box-sizing: border-box;
           -moz-box-sizing: border-box;
                box-sizing: border-box;
      }

      @media screen and (max-width: 480px) {
        .l-project-grid {
          -webkit-justify-content: center;
                  justify-content: center;
          padding: 25px;
        }
      }

      .l-project-grid portfolio-project {
        display: -webkit-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -webkit-flex-direction: row;
            -ms-flex-direction: row;
                flex-direction: row;
        -webkit-align-items: center;
                align-items: center;
        -webkit-box-align: center;
        -moz-box-align: center;
        -ms-flex-align: center;
        -webkit-justify-content: center;
                justify-content: center;
        -webkit-flex: 0 0 30.3333333333%;
            -ms-flex: 0 0 30.3333333333%;
                flex: 0 0 30.3333333333%;
        padding: 1.5%;
      }

      @media screen and (max-width: 767px) {
        .l-project-grid portfolio-project {
          -webkit-flex: 0 0 47%;
              -ms-flex: 0 0 47%;
                  flex: 0 0 47%;
        }
      }

      @media screen and (max-width: 480px) {
        .l-project-grid portfolio-project {
          -webkit-flex: 0 0 97%;
              -ms-flex: 0 0 97%;
                  flex: 0 0 97%;
        }
      }

      #loader {
        position: absolute;
        top: 25px;
        left: 50%;
        display: -webkit-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -webkit-align-items: center;
                align-items: center;
        -webkit-justify-content: center;
                justify-content: center;

        -webkit-transform: translateX(-50%);
           -moz-transform: translateX(-50%);
            -ms-transform: translateX(-50%);
             -o-transform: translateX(-50%);
                transform: translateX(-50%);
      }



    </style>

    <main class="l-content-container">

      <!-- spinner loader -->
      <div id="loader">
        <paper-spinner-lite active="{{projectsEmpty}}"></paper-spinner-lite>
      </div>

      <iron-ajax
          auto
          url="../content.json"
          handle-as="json"
          last-response="{{response}}"
          debounce-duration="300">
      </iron-ajax>

      <!-- <template is="dom-if" if="{{!projectsEmpty}}">
        <section class="l-project-grid">

          <template is="dom-repeat" items="{{response}}" as="project">

              <portfolio-project class="portfolio-project-card" url="[[project.url]]" image="[[project.image]]" alt="[[project.alt]]" title="[[project.title]]"></portfolio-project>

          </template>

        </section>
      </template> -->
      <section class="l-project-grid">

        <template is="dom-repeat" items="{{response}}" as="project">

            <portfolio-project class="portfolio-project-card" url="[[project.url]]" image="[[project.image]]" alt="[[project.alt]]" title="[[project.title]]"></portfolio-project>

        </template>

      </section>

    </main>

    <portfolio-footer></portfolio-footer>

  </template>
  <script>
    /**
     * Registers element within Polymer.
     * @constructor
     */
    Polymer({
      /**
       * Specifies HTML tag name for custom Polymer element.
       * @prop
       */
      is: 'portfolio-home',

      properties: {
        response: {
          type: Array,
          notify: true
        },

        projectsEmpty: {
          type: Boolean,
          value: true,
          computed: '_computeProjectsEmpty(response)'
        },

        /**
         * Array of image src's
         * @type {!Array.<!string>}
         */
        images: {
          type: Array
        },
        /**
         * Array of images that have been loaded
         * @type {!Array.<!Image>}
         */
        loadedImages: {
          type: Array,
          value: function(){
            return [];
          }
        }
      },

      attatched: function() {

        var tl = new TimelineLite({paused: true});
        //tl.from('.l-project-grid', 0.75, {opacity: 0});
        tl.staggerFrom('.portfolio-project-card', 0.5, {y: 20, opacity: 0, ease: Expo.easeOut}, 0.05);

        var images = [
          'images/thumbnails/logo-rewind.png',
          'images/thumbnails/logo-rewind-16.png',
          'images/thumbnails/logo-nextup.png',
          'images/thumbnails/memory.png',
          'images/thumbnails/logo-ats.png',
          'images/thumbnails/badge.png',
          'images/thumbnails/sub.png',
          'images/thumbnails/logo-stitches.png',
          'images/thumbnails/logo-starwars.png',
          'images/thumbnails/logo-slots-alt.png',
          'images/thumbnails/logo-creator.png',
          'images/thumbnails/logo-terra-bella.png'
        ];

        this.preloadImages(images, function() {
          console.log('images loaded');
          tl.play();
        });

      },

      _computeProjectsEmpty: function(response) {
        return response.length === 0;
      },

      /**
       * Fires an event to scroll the page to the top
       * @function
       */
      scrollToTop: function() {
        this.fire('scroll-top');
      },

      /**
       * @param {!Array.<!Image>} images Array of images to load.
       * @param {function} callback Callback for image load completion.
       */
      preloadImages: function(images, callback) {

          //array of images
          this.images = images;

          var counter = 0;

          //wait for final load to be complete before callback
          var loadComplete = function(e) {
            counter++;
            if(counter === images.length && callback){
              callback(this.loadedImages);
            }
          }.bind(this);

          //loop over array && load images
          for(var i = 0; i < images.length; i++){
            this.loadedImages[i] = new Image();
            this.loadedImages[i].src = images[i];
            this.loadedImages[i].onload = loadComplete;
            this.loadedImages[i].onError = loadComplete;
          }

      }

    });
  </script>
</dom-module>
